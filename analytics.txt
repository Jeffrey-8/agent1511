Аналитика:


Правила фильтрации:
1. Отрасли
    * если заполнено industries, по полученным ОКВЭД отфильтровать исходные данные по полю field_5_value_s
    * иначе (industries не заполнено) не фильтровать по ОКВЭД, учитывать весь рынок
2. Выручка
    * если заполнено revenue, по полученному списку отфильтровать исходные данные по полю field_8_value_s
    * иначе (revenue не заполнено) не фильтровать по выручке
3. Штат
    * если заполнено staff, по полученному списку отфильтровать исходные данные по полю field_9_value_s
    * иначе (staff) не фильтровать по штату
4. ТБ
    * если заполнено tb, по полученному списку ТБ отфильтровать исходные данные по полю field_2_value_s
    * иначе (tb не заполнено) не фильтровать по ТБ, учитывать все регионы






Расчеты:
Шаг 1
Оценка рынка по сегментам
1	Сгруппировать отфильтрованные данные по сегментам field_1_value_s
	2	По каждому сегменту выполнить расчёт:
	a	Рынок
	i	отобрать записи, у которых field_4_value_s = "Рынок"
	ii	посчитать сумму значений fact_amt для указанных записей sum(int(fact_amt))
	b	Активные клиенты Банка
	i	отобрать записи, у которых field_4_value_s = "Клиент"
	ii	посчитать сумму значений fact_amt для указанных записей sum(int(fact_amt))
	c	Спящие клиенты и не клиенты Банка
	i	отобрать записи, у которых field_4_value_s = "НеКлиент"
	ii	посчитать сумму значений fact_amt для указанных записей sum(int(fact_amt))
	d	Средняя выручка, млн. р.
	i	числитель:
	1	отобрать записи, у которых field_4_value_s = "Рынок"
	2	посчитать сумму значений fact_amt_2 для указанных записей sum(float(fact_amt_2))
	ii	знаменатель:
	1	отобрать записи, у которых field_4_value_s = "Рынок", посчитать сумму значений fact_amt для указанных записей sum(int(fact_amt))
	2	отобрать записи, у которых field_4_value_s <> "Рынок", посчитать кол-во таких строк
	3	сложить значения
	iii	посчитать среднюю выручку как результат деления числитель/знаменатель, округлить полученное значение до 3х знаков после запятой
	e	Среднее кол-во сотрудников
	i	числитель:
	1	отобрать записи, у которых field_4_value_s = "Рынок"
	2	посчитать сумму значений field_11_value_n для указанных записей sum(float(field_11_value_n))
	ii	знаменатель - использовать расчёт для "Средняя выручка, млн. р."
	iii	посчитать среднюю выручку как результат деления числитель/знаменатель, округлить полученное значение до целого числа


Шаг 2
Расчёт потенциала
1	Для каждого сегмента рассчитать общее кол-во клиентов
	a	calc_clients = сумма ("Рынок" + "Активные клиенты" + "Спящие клиенты и не клиенты банка")
	2	Проверить кол-во клиентов для канала. Для каждого канала из справочника Минимальное кол-во клиентов в канале
	a	Получить минимальное кол-во клиентов для канала min_clients из справочника Минимальное кол-во клиентов в канале
	b	Сравнить рассчитанное для сегмента кол-во клиентов  с минимальным кол-ом клиентов для канала
	i	если calc_clients < min_clients → вынести решение "возможна продажа в канале" = "нет"
	3	Для оставшихся каналов:
	a	Рассчитать потенциал potential_amount в млн. руб.
	i	по умолчанию утилизация = 5%
	ii	использовать формулу расчёта: calc_clients * средний чек для сегмента в руб. /1 000 000 * 0,05
	iii	полученное значение округлить до 3 знаков после запятой
	b	 Рассчитать ставку rate_ab по себестоимости
	i	получить из справочника Цена и себестоимость каналов продаж себестоимость cost_price канала с учётом типа продукта
	ii	рассчитать ставку по формуле rate_ab = cost_price / средний чек для сегмента в руб. * 100 (т.к. считаем ставку в процентах)
	iii	полученное значение округлить до 1 знака после запятой
	iv	если после округления получился 0 → вынести решение "возможна продажа в канале" = "нет"
	c	Рассчитать сумму AB amount_ab в млн. руб
	i	potential_amount * rate_ab / 100 (переводим ставку из процентов)
	d	Рассчитать ЧКД amount_chkd в млн. руб
	i	amount_ab * доля владения / 100 (переводим долю владения из процентов)
	e	Рассчитать прибыль revenue  в млн. руб.
	i	amount_chkd * Кприб / 100 (переводим Кприб из процентов)
	f	Рассчитать итоговый потенциал для канала
	i	amount_ab + amount_chkd + revenue



Справочники

Минимальное кол-во клиентов в канале
Канал	Сегмент	Минимальное кол-во клиентов
DTO	KeyClients	1
КМ ККСБ	КСБ	2700
КМ и ТКМ СКМ	СКМ	10
КМ и ТКМ РГС	РГС	0
ММБ МКК	ММБ	105000
ЦКР	ММБ	115000



Цена и себестоимость каналов продаж
Канал	Сегмент	Тип продукта	Тип суммы	Сумма
DTO	KeyClients	Коробка	Себестоимость	3144,02
		Кастом	Себестоимость	47000,41
		Коробка	Цена	11507,49
		Кастом	Цена	246946,14
КМ ККСБ	КСБ	Коробка	Себестоимость	13270,7
		Кастом	Себестоимость	39653,3
		Коробка	Цена	56395,25
		Кастом	Цена	207865,8
КМ и ТКМ СКМ	СКМ	??	??	??
КМ и ТКМ РГС	РГС	Коробка	Себестоимость	3179,15
		Кастом	Себестоимость	21716,15
		Коробка	Цена	11663,23
		Кастом	Цена	112455,44
ММБ МКК	ММБ	Коробка	Себестоимость	1373,62
		Кастом	Себестоимость	26660,72
		Коробка	Цена	2754,67
		Кастом	Цена	137613,72
ЦКР		Коробка	Себестоимость	1313,63
		Кастом	Себестоимость	6448,67
		Коробка	Цена	2488,74
		Кастом	Цена	30106,27
КМ МС		Коробка	Себестоимость	2499,29
		Кастом	Себестоимость	48109,29
		Коробка	Цена	8187,60
		Кастом	Цена	251705,33



Выручка
•	Менее 1 млн.р.
	•	1-10 млн.р.
	•	10-120 млн.р.
	•	120-800 млн.р.
	•	Более 800 млн.р.
Штат
•	1 чел.
	•	2-5 чел.
	•	6-30 чел.
	•	31-100 чел.
	•	Более 100 чел.
ТБ
•	ЦА
	•	ББ
	•	ВВБ
	•	ДВБ
	•	МБ
	•	ПБ
	•	СЗБ
	•	СибБ
	•	СРБ
	•	УБ
	•	ЦЧБ
	•	ЮЗБ